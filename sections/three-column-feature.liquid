<section class="three-column-feature section-{{ section.id }}-padding">
  <div class="page-width">
    <div class="three-column-feature__grid">
      <!-- Left Section - Product Info -->
      <div class="three-column-feature__column three-column-feature__column--left">
        <div class="three-column-feature__content">
          {%- if section.settings.left_heading != blank -%}
            <h2 class="three-column-feature__heading three-column-feature__heading--left">
              {{ section.settings.left_heading }}
            </h2>
          {%- endif -%}

          {%- if section.settings.left_description != blank -%}
            <p class="three-column-feature__description three-column-feature__description--left">
              {{ section.settings.left_description }}
            </p>
          {%- endif -%}

          {%- if section.settings.left_image != blank -%}
            <div class="three-column-feature__image-wrapper three-column-feature__image-wrapper--left">
              {{
                section.settings.left_image
                | image_url: width: 400
                | image_tag: class: 'three-column-feature__image three-column-feature__image--left', loading: 'lazy'
              }}
            </div>
          {%- endif -%}

          {%- if section.settings.left_button_text != blank and section.settings.left_button_link != blank -%}
            <a
              href="{{ section.settings.left_button_link }}"
              class="three-column-feature__button three-column-feature__button--left"
            >
              {{ section.settings.left_button_text }}
            </a>
          {%- endif -%}
        </div>

        <!-- Middle Section - Bundle Info -->
        <div class="three-column-feature__column three-column-feature__column--middle">
          <div class="three-column-feature__card three-column-feature__card--middle">
            {%- if section.settings.middle_heading != blank -%}
              <h2 class="three-column-feature__heading three-column-feature__heading--middle">
                {{ section.settings.middle_heading }}
              </h2>
            {%- endif -%}

            {%- if section.settings.middle_description != blank -%}
              <div class="three-column-feature__description three-column-feature__description--middle">
                {{ section.settings.middle_description }}
              </div>
            {%- endif -%}

            {%- if section.settings.middle_button_text != blank and section.settings.middle_button_link != blank -%}
              <a
                href="{{ section.settings.middle_button_link }}"
                class="three-column-feature__button three-column-feature__button--middle"
              >
                {{ section.settings.middle_button_text }}
              </a>
            {%- endif -%}
          </div>
        </div>
      </div>

      <!-- Right Section - Video with Before/After -->
      <div class="three-column-feature__column three-column-feature__column--right">
        <div class="three-column-feature__video-section">
          {%- if section.settings.video_poster != blank -%}
            <!-- Close Button for Modal -->
            <button id="close-video-modal" class="video-modal__close" aria-label="Close Video Modal">X</button>
            <div class="three-column-feature__video-wrapper" data-video-wrapper>
              {{
                section.settings.video_poster
                | image_url: width: 500
                | image_tag: class: 'three-column-feature__video-poster', loading: 'lazy'
              }}

              {%- if section.settings.video_url != blank -%}
                <button
                  class="three-column-feature__play-button"
                  data-video-url="{{ section.settings.video_url }}"
                  aria-label="Play video"
                >
                  <img src="{{'video-play.svg' |  asset_url}}" alt="icon-play" width="48" height="48">
                </button>
              {%- endif -%}
            </div>
          {%- endif -%}

          <div class=" three-column-feature__card--right">
            {%- if section.settings.right_heading != blank -%}
              <h3 class="three-column-feature__heading three-column-feature__heading--right">
                {{ section.settings.right_heading }}
              </h3>
            {%- endif -%}
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .three-column-feature {
    padding: 50px 0 84px;
    background-color: var(--white);
  }

  .three-column-feature__grid {
    display: grid;
    align-items: start;
    grid-template-columns: repeat(2, 1fr);
    gap: 32px;
  }

  .three-column-feature__column {
    display: flex;
  }
  .three-column-feature__column--left {
    flex-direction: row;
    gap: 32px;
  }
  .three-column-feature__column--left > div {
    flex: 1;
  }
  .three-column-feature__content {
    padding: 22px 30px 23px;
    background-color: var(--white);
    position: relative;
    z-index: 1;
    display: flex;
    flex-direction: column;
  }
  .three-column-feature__heading {
    font-size: 24px;
    font-weight: 600;
    line-height: 24px;
    margin: 0 0 15px 0;
    color: var(--light-black);
  }

  .three-column-feature__description,
  .three-column-feature__description p {
    font-size: 14px;
    line-height: 25.5px;
    color: var(--light-black);
    font-weight: 500;
    margin: 0;
    letter-spacing: 0;
    max-width: 305px;
  }

  .three-column-feature__description p + p {
    margin: 10px 0 18px;
  }

  .three-column-feature__image-wrapper {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
  }

  .three-column-feature__image {
    width: 100%;
    height: 100%;
    display: block;
  }

  .three-column-feature__card {
    background-color: var(--secondary-color);
    padding: 30px;
    width: 100%;
    border-radius: 16px;
  }

  .three-column-feature__button {
    display: inline-block;
    text-decoration: none;
    width: 187px;
    height: 56px;
    line-height: 56px;
    border-radius: 108px;
    font-weight: 600;
    font-size: 14px;
    transition: all 0.3s ease;
    border: 1px solid var(--secondary-color);
    color: var(--dark-primary-color);
    background-color: var(--primary-color);
    cursor: pointer;
    text-align: center;
    margin-inline: auto;
    display: block;
  }
  .three-column-feature__button.three-column-feature__button--left {
    margin-top: auto;
  }

  .three-column-feature__video-section {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    border-radius: 16px;
    overflow: hidden;
    position: relative;
  }

  .three-column-feature__video-wrapper {
    position: relative;
    width: 100%;
  }

  .three-column-feature__video-poster {
    width: 100%;
    height: 100%;
    display: block;

    max-height: 285px;
  }

  .three-column-feature__play-button {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
    transition: transform 0.3s ease;
  }

  .three-column-feature__play-icon {
    width: 48px;
    height: 48px;
  }
  .three-column-feature__card--right {
    padding: 29px 15px 33px;
    background-color: var(--icon-color);
    width: 100%;
  }
  .three-column-feature__card--right .three-column-feature__heading {
    margin: 0;
    text-align: center;
  }
  /* Close Button Styles */
  .video-modal__close {
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 20px;
    font-weight: bold;
    background: none;
    border: none;
    cursor: pointer;
    color: var(--light-black);
    background-color: var(--white);
    width: 30px;
    height: 30px;
    line-height: 30px;
    z-index: 2;
    display: none;
  }
  @media only screen and (max-width: 1199px) {
    .three-column-feature__grid {
      grid-template-columns: 1fr;
      gap: 24px;
    }
    .three-column-feature__button {
      width: 100%;
      height: 44px;
      line-height: 44px;
    }
  }
  @media only screen and (max-width: 767px) {
    .three-column-feature__column--left {
      flex-direction: column;
      gap: 24px;
    }
    .three-column-feature__content {
      min-height: 360px;
    }
    .three-column-feature__card--right {
      padding: 15px;
    }
    .three-column-feature__card--right .three-column-feature__heading {
      font-size: 18px;
    }
    .three-column-feature {
      padding: 50px 0;
    }
  }
</style>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const playButtons = document.querySelectorAll('.three-column-feature__play-button');
    const closeButton = document.getElementById('close-video-modal');

    playButtons.forEach(function (button) {
      button.addEventListener('click', function (event) {
        const videoUrl = button.getAttribute('data-video-url');

        if (!videoUrl) return;

        const videoWrapper = button.closest('[data-video-wrapper]');
        if (!videoWrapper) return;

        // Clear existing content (poster + button)
        videoWrapper.innerHTML = '';

        // Check if the URL is from YouTube
        let embedUrl = '';
        if (videoUrl.includes('youtube.com')) {
          const videoId = videoUrl.split('v=')[1].split('&')[0]; // Get the video ID from the URL
          embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1`;
        } else if (videoUrl.includes('vimeo.com')) {
          const videoId = videoUrl.split('/').pop(); // Extract the video ID from Vimeo URL
          embedUrl = `https://player.vimeo.com/video/${videoId}?autoplay=1`;
        } else {
          embedUrl = videoUrl; // Fallback to the provided URL if not YouTube/Vimeo
        }

        // Create the iframe for the video
        const iframe = document.createElement('iframe');
        iframe.setAttribute('src', embedUrl);
        iframe.setAttribute('frameborder', '0');
        iframe.setAttribute('allow', 'autoplay; encrypted-media');
        iframe.setAttribute('allowfullscreen', 'true');
        iframe.style.width = '100%';
        iframe.style.height = '285px';

        // Append the iframe to the wrapper
        videoWrapper.appendChild(iframe);
      });
    });

    // Close the video modal when the close button is clicked
    if (closeButton) {
      closeButton.addEventListener('click', function () {
        console.log('ðŸš€ ~ closeButton:', closeButton);
        const videoWrapper = closeButton.closest('.three-column-feature__video-wrapper');
        console.log('ðŸš€ ~ videoWrapper:', videoWrapper);
        if (videoWrapper) {
          // Remove the video (iframe)
          videoWrapper.innerHTML = '';

          // Add the original poster and play button back to the wrapper
          videoWrapper.innerHTML = `
          <img src="{{ section.settings.video_poster | image_url: width: 500 | image_tag: class: 'three-column-feature__video-poster', loading: 'lazy' }}" />
          <button
            class="three-column-feature__play-button"
            data-video-url="{{ section.settings.video_url }}"
            aria-label="Play video"
          >
            <img src="{{'video-play.svg' | asset_url}}" alt="icon-play" width="48" height="48">
          </button>
        `;
        }
      });
    }
  });
</script>

{% schema %}
{
  "name": "Three Column Feature",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Left Column - Product Info"
    },
    {
      "type": "text",
      "id": "left_heading",
      "label": "Heading",
      "default": "Handmade. Vegan. Iconic."
    },
    {
      "type": "textarea",
      "id": "left_description",
      "label": "Description",
      "default": "Make your powder foundation glow with this brush."
    },
    {
      "type": "image_picker",
      "id": "left_image",
      "label": "Product Image"
    },
    {
      "type": "text",
      "id": "left_button_text",
      "label": "Button Text",
      "default": "Get This Bundle"
    },
    {
      "type": "url",
      "id": "left_button_link",
      "label": "Button Link"
    },
    {
      "type": "header",
      "content": "Middle Column - Bundle Info"
    },
    {
      "type": "text",
      "id": "middle_heading",
      "label": "Heading",
      "default": "Bundle & Save"
    },
    {
      "type": "richtext",
      "id": "middle_description",
      "label": "Description",
      "default": "<p>Finish your look with our Glow Box Bundle. Bronzer, Contour, Highlighter, Blush & Brush. All of the magical skincare benefits and everything you need to finish your look in a stunning pink and gold box at an amazing price!</p>"
    },
    {
      "type": "text",
      "id": "middle_button_text",
      "label": "Button Text",
      "default": "Get This Bundle"
    },
    {
      "type": "url",
      "id": "middle_button_link",
      "label": "Button Link"
    },
    {
      "type": "header",
      "content": "Right Column - Video Section"
    },
    {
      "type": "image_picker",
      "id": "video_poster",
      "label": "Video Poster Image (Before/After)"
    },
    {
      "type": "url",
      "id": "video_url",
      "label": "Video URL (YouTube or direct video)"
    },
    {
      "type": "text",
      "id": "right_heading",
      "label": "Video Title",
      "default": "Natural Coverage For Marks & Scars"
    }
  ],
  "presets": [
    {
      "name": "Three Column Feature",
      "category": "Custom Sections"
    }
  ]
}
{% endschema %}
